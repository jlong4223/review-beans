<%- include('../partials/header') %>

<body id="reviewpage">
  <!-- <a href="/coffees">Back to the list</a> -->
  
  <div id="topcontainer" class="container">
    <div id="topbox" class="d-flex justify-content-center h-100">
      <div id="detailscard" class="card">

        <div class="card-header">
          <h1> Details </h1>
          <div class="d-flex justify-content-end social_icon">
            <span><i class="fas fa-coffee"></i></span>
          </div>
        </div>
        <div class="card-body">
          <section id="detailsSec">
            <div class="details">
              <h3>Coffee Shop:</h3>
            </div>
            <div>
              <h6><%=coffee.shop%></h6>
            </div>
            <div class="details">
              <h3>Location:</h3>
            </div>
            <div>
              <h6><%=coffee.location%></h6>
            </div>
            <div class="details">
              <h3>Coffee Tried:</h3>
            </div>
            <div>
              <h6><%=coffee.coffeetype%></h6>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>


  <div class="container">
    <div id="bottombox" class="d-flex justify-content-center h-100">
      <div id="reviewcard" class="card">
        <div class="card-header">
          <h2>Review</h2>
          <div class="d-flex justify-content-end social_icon">
            <span><i class="fas fa-coffee"></i></span>
          </div>
        </div>
        <div class="card-body">
          <section id="enterreview">
          <form id="add-revew-form" method="POST" action="/coffees/<%=coffee._id%>/details">
            <div class="input-group form-group">
            <label> Review:</label>
            <textarea id="reviewtext" name="review"></textarea>
            </div>
            <div class="input-group form-group">
            <label class="reviewform"> Rating: </label>
            <select class="reviewform" id="rating" name="rating">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
            </div>
            <div class="form-group">
            <input id="reviewbtn" type="submit" value="Add Review">
            </div>
          </form>
          </section>
        </div>
      </div>
    </div>
  </div>


  <% if (coffee.details.length) { %>
  <table>
    <thead>
      <tr>
        <!-- <th>Date</th> -->
        <th>Review</th>
        <th>Rating</th>
        <!-- <th>Username</th> TODO figure out how to add username -->
      </tr>
    </thead>
    <tbody>
      <% let total = 0 %>
      <% coffee.details.forEach(function(d) { %>
      <% total+= d.rating %>
      <tr>

        <td><%= d.review %></td>
        <td><%= d.rating %></td>

      </tr>
      <% }); %>
      <tr>
        <td colspan="2"></td>
        <td><strong>Average Rating: <%= (total / coffee.details.length).toFixed(1) %></strong></td>
      </tr>
    </tbody>
  </table>
  <% } else { %>
  <h5>No Reviews Yet</h5>
  <% } %>


</body>