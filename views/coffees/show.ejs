<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel='stylesheet' href='/css/style.css' />
  <title>Details</title>
</head>

<body id="reviewpage">
  <!-- <a href="/coffees">Back to the list</a> -->

  <div id="topcontainer" class="container">
    <div id="topbox" class="d-flex justify-content-center h-100">
      <div id="detailscard" class="card">

        <div class="card-header">
          <h1> Details </h1>
          <div class="d-flex justify-content-end social_icon">
            <span><i class="fas fa-coffee fa-2x"></i></span>
          </div>
        </div>
        <div class="card-body">
          <section id="detailsSec">
            <div>
              <h3><%=coffee.shop%></h3>
            </div>
            <div class="details">
              <h6>Shop</h6>
            </div>
            <div>
              <h3><%=coffee.location%></h3>
            </div>
            <div class="details">
              <h6>Location</h6>
            </div>
            <div>
              <h3><%=coffee.coffeetype%></h3>
            </div>
            <div class="details">
              <h6>Coffee</h6>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>


  <div class="container">
    <div id="bottombox" class="d-flex justify-content-center h-100">
      <div id="reviewcard" class="card">
        <div class="card-header">
          <h2>Add a Review</h2>
          <div class="d-flex justify-content-end social_icon">
            <span><i class="fas fa-coffee fa-2x"></i></span>
          </div>
        </div>
        <div class="card-body">
          <section id="enterreview">
            <form id="add-revew-form" method="POST" action="/coffees/<%=coffee._id%>/details">
              <div class="input-group form-group">
                <label> Review:</label>
                <textarea id="reviewtext" name="review"></textarea>
              </div>
              <div class="input-group form-group">
                <label class="reviewform"> Rating: </label>
                <select class="reviewform" id="rating" name="rating">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
              </div>
              <div class="form-group">
                <input id="reviewbtn" type="submit" value="Add Review">
              </div>
            </form>
          </section>
        </div>
      </div>
    </div>
  </div>


  <% if (coffee.details.length) { %>
  <div class="container">
    <div id="bottombox" class="d-flex justify-content-center h-100">
      <div id="reviewcard" class="card">
        <table>
          <div class="card-header">
            <h2> Reviews</h2>
            <thead>
              <tr>
                <!-- <th>Date</th> -->
                <th>Review</th>
                <th>Rating</th>
                <!-- <th>Username</th> TODO figure out how to add username -->
              </tr>
            </thead>
          </div>
          <tbody>
            <% let total = 0 %>
            <% coffee.details.forEach(function(d) { %>
            <% total+= d.rating %>
            <tr>

              <td><%= d.review %></td>
              <td><%= d.rating %></td>

            </tr>
            <% }); %>
            <tr>
              <td colspan="2"></td>
              <td><strong>Average Rating: <%= (total / coffee.details.length).toFixed(1) %></strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <% } else { %>
  <h5>No Reviews Yet</h5>
  <% } %>



</body>