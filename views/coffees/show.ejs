<%- include('../partials/header') %>

<body>
  <a href="/coffees">Back to the list</a>
  <div class="container">
    <div class="d-flex justify-content-center h-100">
      <div class="card">

        <div class="card-header">
          <h1> Details </h1>
          <div class="d-flex justify-content-end social_icon">
            <span><i class="fas fa-coffee"></i></span>
          </div>
        </div>
        <div class="card-body">
        <section id="detailsSec">
          <div class="details"><h3>Coffee Shop:</h3> </div>
          <div><h6><%=coffee.shop%></h6></div>
          <div class="details"><h3>Location:</h3> </div>
          <div><h6><%=coffee.location%></h6></div>
          <div class="details"><h3>Coffee Tried:</h3></div>
          <div><h6><%=coffee.coffeetype%></h6></div>
        </section>
      </div>
    </div>
  </div>




  <h2>Reviews</h2>
  <form id="add-revew-form" method="POST" action="/coffees/<%=coffee._id%>/details">
    <label> Review:</label>
    <textarea name="review"></textarea>
    <label> Rating: </label>
    <select id="rating" name="rating">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
    <input id="reviewbtn" type="submit" value="Add Review">
  </form>

  <% if (coffee.details.length) { %>
  <table>
    <thead>
      <tr>
        <!-- <th>Date</th> -->
        <th>Review</th>
        <th>Rating</th>
        <!-- <th>Username</th> TODO figure out how to add username -->
      </tr>
    </thead>
    <tbody>
      <% let total = 0 %>
      <% coffee.details.forEach(function(d) { %>
      <% total+= d.rating %>
      <tr>

        <td><%= d.review %></td>
        <td><%= d.rating %></td>

      </tr>
      <% }); %>
      <tr>
        <td colspan="2"></td>
        <td><strong>Average Rating: <%= (total / coffee.details.length).toFixed(1) %></strong></td>
      </tr>
    </tbody>
  </table>
  <% } else { %>
  <h5>No Reviews Yet</h5>
  <% } %>


</body>